/*!
* @author Sean Coker <sean@seancoker.com>
* @version 1.12.0
* @url http://sean.is/poppin/tags
* @license MIT
* @description Taggle is a dependency-less tagging library
*/
Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},s=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,s.prototype=new n,s}),window.getComputedStyle||(window.getComputedStyle=function(t){return t.currentStyle}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var e,i,n=Object(this),s=n.length>>>0;if(0===s)return-1;if(e=0,arguments.length>1&&((e=Number(arguments[1]))!=e?e=0:0!=e&&e!=1/0&&e!=-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e)))),e>=s)return-1;for(i=e>=0?e:Math.max(s-Math.abs(e),0);s>i;i++)if(i in n&&n[i]===t)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var i,n;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),a=s.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(i=e),n=0;a>n;){var r;n in s&&(r=s[n],t.call(i,r,n,s)),n++}}),Array.prototype.map||(Array.prototype.map=function(t,e){var i,n,s;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),r=a.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(i=e),n=new Array(r),s=0;r>s;){var o,l;s in a&&(o=a[s],l=t.call(i,o,s,a),n[s]=l),s++}return n}),"undefined"==typeof document||"classList"in document.documentElement||function(t){"use strict";if("HTMLElement"in t||"Element"in t){var e="classList",i="prototype",n=(t.HTMLElement||t.Element)[i],s=Object,a=String[i].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[i].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},o=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},l=function(t,e){if(""===e)throw new o("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(e))throw new o("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(t,e)},h=function(t){for(var e=a.call(t.className),i=e?e.split(/\s+/):[],n=0,s=i.length;s>n;n++)this.push(i[n]);this._updateClassName=function(){t.className=this.toString()}},u=h[i]=[],c=function(){return new h(this)};if(o[i]=Error[i],u.item=function(t){return this[t]||null},u.contains=function(t){return-1!==l(this,t+="")},u.add=function(){var t,e=arguments,i=0,n=e.length,s=!1;do{t=e[i]+"",-1===l(this,t)&&(this.push(t),s=!0)}while(++i<n);s&&this._updateClassName()},u.remove=function(){var t,e=arguments,i=0,n=e.length,s=!1;do{t=e[i]+"";var a=l(this,t);-1!==a&&(this.splice(a,1),s=!0)}while(++i<n);s&&this._updateClassName()},u.toggle=function(t,e){t+="";var i=this.contains(t),n=i?!0!==e&&"remove":!1!==e&&"add";return n&&this[n](t),!i},u.toString=function(){return this.join(" ")},s.defineProperty){var p={get:c,enumerable:!0,configurable:!0};try{s.defineProperty(n,e,p)}catch(t){-2146823252===t.number&&(p.enumerable=!1,s.defineProperty(n,e,p))}}else s[i].__defineGetter__&&n.__defineGetter__(e,c)}}(self),function(t,e){"use strict";var i="Taggle";"function"==typeof define&&define.amd?define([],(function(){var n=e();return t[i]=n,n})):"object"==typeof module&&module.exports?module.exports=t[i]=e():t[i]=e()}(this,(function(){"use strict";function t(){for(var t=arguments[0],e=1,i=arguments.length;i>e;e++){var n=arguments[e];for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])}return t}function e(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent?t.attachEvent("on"+e,i):t["on"+e]=i}function i(t,e){window.attachEvent&&!window.addEventListener?t.innerText=e:t.textContent=e}var n=function(){},s={additionalTagClasses:"",allowDuplicates:!1,saveOnBlur:!1,clearOnBlur:!0,duplicateTagClass:"",containerFocusClass:"active",focusInputOnContainerClick:!0,hiddenInputName:"taggles[]",tags:[],delimeter:",",delimiter:"",attachTagId:!1,allowedTags:[],disallowedTags:[],maxTags:null,tabIndex:1,placeholder:"Enter tags...",submitKeys:[188,9,13],preserveCase:!1,inputFormatter:n,tagFormatter:n,onBeforeTagAdd:n,onTagAdd:n,onBeforeTagRemove:function(){return!0},onTagRemove:n},a=function(e,i){this.settings=t({},s,i),this.measurements={container:{rect:null,style:null,padding:null}},this.container=e,this.tag={values:[],elements:[]},this.list=document.createElement("ul"),this.inputLi=document.createElement("li"),this.input=document.createElement("input"),this.sizer=document.createElement("div"),this.pasting=!1,this.placeholder=null,this.data=null,this.settings.placeholder&&(this.placeholder=document.createElement("span")),"string"==typeof e&&(this.container=document.getElementById(e)),this._id=0,this._setMeasurements(),this._setupTextarea(),this._attachEvents()};return a.prototype._setMeasurements=function(){this.measurements.container.rect=this.container.getBoundingClientRect(),this.measurements.container.style=window.getComputedStyle(this.container);var t=this.measurements.container.style,e=parseInt(t["padding-left"]||t.paddingLeft,10),i=parseInt(t["padding-right"]||t.paddingRight,10),n=parseInt(t["border-left-width"]||t.borderLeftWidth,10),s=parseInt(t["border-right-width"]||t.borderRightWidth,10);this.measurements.container.padding=e+i+n+s},a.prototype._setupTextarea=function(){var t;if(this.list.className="taggle_list",this.input.type="text",this.input.style.paddingLeft=0,this.input.style.paddingRight=0,this.input.className="taggle_input",this.input.tabIndex=this.settings.tabIndex,this.sizer.className="taggle_sizer",this.settings.tags.length)for(var e=0,n=this.settings.tags.length;n>e;e++){var s=this._createTag(this.settings.tags[e]);this.list.appendChild(s)}this.placeholder&&(this.placeholder.style.opacity=0,this.placeholder.classList.add("taggle_placeholder"),this.container.appendChild(this.placeholder),i(this.placeholder,this.settings.placeholder),this.settings.tags.length||this._showPlaceholder());var a=this.settings.inputFormatter(this.input);a&&(this.input=a),this.inputLi.appendChild(this.input),this.list.appendChild(this.inputLi),this.container.appendChild(this.list),this.container.appendChild(this.sizer),t=window.getComputedStyle(this.input).fontSize,this.sizer.style.fontSize=t},a.prototype._attachEvents=function(){var t=this;this.settings.focusInputOnContainerClick&&e(this.container,"click",(function(){t.input.focus()})),e(this.input,"focus",this._focusInput.bind(this)),e(this.input,"blur",this._blurEvent.bind(this)),e(this.input,"keydown",this._keydownEvents.bind(this)),e(this.input,"keyup",this._keyupEvents.bind(this))},a.prototype._fixInputWidth=function(){var t,e,i,n,s;this._setMeasurements(),this._setInputWidth(),e=this.input.getBoundingClientRect(),(t=~~(i=this.measurements.container.rect).width)||(t=~~i.right-~~i.left),n=~~e.left-~~i.left,s=this.measurements.container.padding,this._setInputWidth(t-n-s)},a.prototype._canAdd=function(t,e){if(!e)return!1;var i=this.settings.maxTags;if(null!==i&&i<=this.getTagValues().length)return!1;if(!1===this.settings.onBeforeTagAdd(t,e))return!1;if(!this.settings.allowDuplicates&&this._hasDupes(e))return!1;var n=this.settings.preserveCase,s=this.settings.allowedTags;if(s.length&&!this._tagIsInArray(e,s,n))return!1;var a=this.settings.disallowedTags;return!a.length||!this._tagIsInArray(e,a,n)},a.prototype._tagIsInArray=function(t,e,i){if(i)return-1!==e.indexOf(t);var n=[].slice.apply(e).map((function(t){return t.toLowerCase()}));return-1!==n.indexOf(t)},a.prototype._add=function(t,e){var i=this,n=e||"";"string"!=typeof e&&(n=function(t){return t.replace(/^\s+|\s+$/g,"")}(this.input.value));var s=this.settings.delimiter||this.settings.delimeter;n.split(s).map((function(t){return i._formatTag(t)})).forEach((function(e){if(i._canAdd(t,e)){var n=i._createTag(e),s=i.list.children,a=s[s.length-1];i.list.insertBefore(n,a),e=i.tag.values[i.tag.values.length-1],i.settings.onTagAdd(t,e),i.input.value="",i._fixInputWidth(),i._focusInput()}}))},a.prototype._checkLastTag=function(t){t=t||window.event;var e=this.container.querySelectorAll(".taggle"),i=e[e.length-1],n="taggle_hot",s=this.input.classList.contains("taggle_back");""!==this.input.value||8!==t.keyCode||s?i.classList.contains(n)&&i.classList.remove(n):i.classList.contains(n)?(this.input.classList.add("taggle_back"),this._remove(i,t),this._fixInputWidth(),this._focusInput()):i.classList.add(n)},a.prototype._setInputWidth=function(t){this.input.style.width=(t||10)+"px"},a.prototype._hasDupes=function(t){var e,i=this.tag.values.indexOf(t),n=this.container.querySelector(".taggle_list");if(this.settings.duplicateTagClass)for(var s=0,a=(e=n.querySelectorAll("."+this.settings.duplicateTagClass)).length;a>s;s++)e[s].classList.remove(this.settings.duplicateTagClass);return i>-1&&(this.settings.duplicateTagClass&&n.childNodes[i].classList.add(this.settings.duplicateTagClass),!0)},a.prototype._isConfirmKey=function(t){var e=!1;return this.settings.submitKeys.indexOf(t)>-1&&(e=!0),e},a.prototype._focusInput=function(){this._fixInputWidth(),this.container.classList.contains(this.settings.containerFocusClass)||this.container.classList.add(this.settings.containerFocusClass),this.placeholder&&(this.placeholder.style.opacity=0)},a.prototype._blurEvent=function(t){if(this.container.classList.contains(this.settings.containerFocusClass)&&this.container.classList.remove(this.settings.containerFocusClass),this.settings.saveOnBlur){if(t=t||window.event,this._listenForEndOfContainer(),""!==this.input.value)return void this._confirmValidTagEvent(t);this.tag.values.length&&this._checkLastTag(t)}else this.settings.clearOnBlur&&(this.input.value="",this._setInputWidth());this.tag.values.length||this.input.value||this._showPlaceholder()},a.prototype._keydownEvents=function(t){var e=(t=t||window.event).keyCode;return this.pasting=!1,this._listenForEndOfContainer(),86===e&&t.metaKey&&(this.pasting=!0),this._isConfirmKey(e)&&""!==this.input.value?void this._confirmValidTagEvent(t):void(this.tag.values.length&&this._checkLastTag(t))},a.prototype._keyupEvents=function(t){t=t||window.event,this.input.classList.remove("taggle_back"),i(this.sizer,this.input.value),this.pasting&&""!==this.input.value&&(this._add(t),this.pasting=!1)},a.prototype._confirmValidTagEvent=function(t){(t=t||window.event).preventDefault?t.preventDefault():t.returnValue=!1,this._add(t)},a.prototype._listenForEndOfContainer=function(){var t=this.sizer.getBoundingClientRect().width,e=this.measurements.container.rect.width-this.measurements.container.padding;t+1.5*parseInt(this.sizer.style.fontSize,10)>parseInt(this.input.style.width,10)&&(this.input.style.width=e+"px")},a.prototype._createTag=function(t){var n=document.createElement("li"),s=document.createElement("button"),a=document.createElement("input"),r=document.createElement("span");t=this._formatTag(t),s.innerHTML="&times;",s.className="close",s.type="button",e(s,"click",this._remove.bind(this,s)),i(r,t),r.className="taggle_text",n.className="taggle "+this.settings.additionalTagClasses,a.type="hidden",a.value=t,a.name=this.settings.hiddenInputName,n.appendChild(r),n.appendChild(s),n.appendChild(a);var o=this.settings.tagFormatter(n);if(void 0!==o&&(n=o),!(n instanceof HTMLElement)||"LI"!==n.tagName)throw new Error("tagFormatter must return an li element");return this.settings.attachTagId&&(this._id+=1,t={text:t,id:this._id}),this.tag.values.push(t),this.tag.elements.push(n),n},a.prototype._showPlaceholder=function(){this.placeholder&&(this.placeholder.style.opacity=1)},a.prototype._remove=function(t,e){function i(i){i||(t.parentNode.removeChild(t),r.tag.elements.splice(a,1),r.tag.values.splice(a,1),r.settings.onTagRemove(e,n),r._focusInput())}var n,s,a,r=this;"li"!==t.tagName.toLowerCase()&&(t=t.parentNode),s="a"===t.tagName.toLowerCase()?t.parentNode:t,a=this.tag.elements.indexOf(s),n=this.tag.values[a],this.settings.onBeforeTagRemove(e,n,i)&&i()},a.prototype._formatTag=function(t){return this.settings.preserveCase?t:t.toLowerCase()},a.prototype.getTags=function(){return{elements:this.getTagElements(),values:this.getTagValues()}},a.prototype.getTagElements=function(){return this.tag.elements},a.prototype.getTagValues=function(){return[].slice.apply(this.tag.values)},a.prototype.getInput=function(){return this.input},a.prototype.getContainer=function(){return this.container},a.prototype.add=function(t){var e=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)}(t);if(e)for(var i=0,n=t.length;n>i;i++)"string"==typeof t[i]&&this._add(null,t[i]);else this._add(null,t);return this},a.prototype.remove=function(t,e){for(var i=this.tag.values.length-1,n=!1;i>-1;){var s=this.tag.values[i];if(this.settings.attachTagId&&(s=s.text),s===t&&(n=!0,this._remove(this.tag.elements[i])),n&&!e)break;i--}return this},a.prototype.removeAll=function(){for(var t=this.tag.values.length-1;t>=0;t--)this._remove(this.tag.elements[t]);return this._showPlaceholder(),this},a.prototype.setOptions=function(e){return this.settings=t({},this.settings,e||{}),this},a.prototype.enable=function(){var t=[].slice.call(this.container.querySelectorAll("button")),e=[].slice.call(this.container.querySelectorAll("input"));return t.concat(e).forEach((function(t){t.removeAttribute("disabled")})),this},a.prototype.disable=function(){var t=[].slice.call(this.container.querySelectorAll("button")),e=[].slice.call(this.container.querySelectorAll("input"));return t.concat(e).forEach((function(t){t.setAttribute("disabled","")})),this},a.prototype.setData=function(t){return this.data=t,this},a.prototype.getData=function(){return this.data},a}));